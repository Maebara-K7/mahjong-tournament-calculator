# 日麻终局状况计算器 (Riichi Mahjong Condition Calculator)

这是一个基于 Python 的命令行工具，专门用于计算日本麻将（特别是比赛规则）在特定对局状况下，各家为了达成特定顺位目标的和牌、放铳及流局条件。

对于需要精确计算点差和顺位的竞技麻将玩家和解说来说，这是一个强大而精准的辅助工具。

## 核心功能

- **主动和牌条件**:
  - **自摸 (Tsumo)**: 计算玩家需要自摸多大的牌（例如 `2000/4000`）才能达成目标顺位。
  - **荣和 (Ron)**: 计算玩家需要荣和某位对手多大的牌才能达成目标顺位。

- **被动安全条件**:
  - **被自摸 (Passive Tsumo)**: 计算在对手自摸多大的牌以内，自己仍然能保持在目标顺位。
  - **放铳 (Passive Ron)**: 计算自己放铳给某位对手多大的牌以内，仍然能保持在目标顺位。

- **流局条件 (Ryuukyoku)**:
  - 分析在流局时，自己听牌或不听牌，以及其他对手的听牌组合，对最终顺位的影响。

- **规则高度可配置**:
  - 通过 `rulesets.py` 文件预设了多种主流规则集（如 M-League、天凤等）。
  - 轻松区分对局终了和连庄续行两种情况下的不同条件。

## 项目结构与必需文件

要运行此项目，请确保以下核心文件位于同一目录下：

1.  `main.py`: **主程序入口**。用于对特定场景进行精确计算。
2.  `practice.py`: **交互式练习工具**。用于随机生成题目并进行状况计算练习。
3.  `calculation.py`: **核心计算模块**。包含了所有复杂博弈情况的计算逻辑。
4.  `cond_lib.py`: **基础函数库**。提供点数生成、顺位计算、对局是否继续等基础支持。
5.  `rulesets.py`: **规则集定义**。存储了不同麻将规则的顺位马、起始点等关键参数。

## 如何使用

1.  **配置对局状况**: 打开 `main.py` 文件，找到文件底部的 `if __name__ == "__main__":` 部分。
2.  **修改参数**: 根据您需要计算的实际对局情况，修改以下变量：
    - `ruleset_name`: 要使用的规则集名称 (例如 `"ML"`)。
    - `start_pts`: 本场比赛开始前，四位玩家的累计得分。
    - `pts_in_hand`: 当前时刻，四位玩家的持有点数（棒点）。
    - `deposit`: 场上剩余的立直棒数量。
    - `riichi_status`: 一个四元列表，标记哪些玩家已立直 (例如 `[1, 0, 0, 0]`)。
    - `goal_placement`: 您为玩家设定的目标顺位 (例如 `2`，代表进入前二)。
    - `oya`: 当前亲家的座位号 (0-3)。
    - `honba`: 当前的本场数。
3.  **运行脚本**: 在终端中执行命令：
    ```bash
    python main.py
    ```
4.  **查看结果**: 脚本将会在终端中直接打印出为四位玩家计算出的详细条件。

## 练习与考试模式 (Practice & Exam Mode)

为了帮助用户熟悉和掌握不同情况下的状况计算，项目提供了一个功能丰富的交互式练习工具 `practice.py`。

- **随机场景**: 自动生成符合特定规则的随机对局情况。
- **智能提问**: 优先选择非一位的玩家进行提问，使练习更具挑战性。
- **交互式问答**: 在终端中向用户提问并检验答案。
- **分级难度**: 提供 **普通 (Simple)**、**困难 (Hard)** 和 **魔鬼 (Devil)** 三种难度的练习。难度越高，正确答案的条件组合（“或”逻辑）也越复杂。
- **考试模式**: 模拟真实考试环境，检验综合计算能力。

### 如何使用

1.  在终端中执行命令：
    ```bash
    python practice.py
    ```
2.  程序会显示一个菜单，您可以根据需要选择不同的功能：
    - **1. 开始练习 (普通)**: 开始一道随机普通难度的题目。
    - **2. 开始练习 (困难)**: 开始一道随机困难难度的题目。
    - **3. 开始练习 (魔鬼)**: 从题库中抽取或生成一道魔鬼难度的题目。
    - **4. 开始考试模式**:
        - **题型**: 随机抽取 **3道普通、2道困难、1道魔鬼** 题目，共6题。
        - **计分**: 总分100分。普通题每题10分，困难题20分，魔鬼题30分。
        - **计时**: 总时长 **30分钟**。每完成一题会显示单题用时和剩余总时间。
        - **超时扣分**: 总用时超出30分钟后，**每15秒扣1分**。
    - **5. 查看上次考试种子**: 用于复盘和重新进行上一次的考试。

### 答案格式

程序支持多种灵活的答案格式：
- **不连续值**: 使用 `或`、`,`、`|`、`or` 分隔，例如 `1000 或 2000`。
- **范围**: 使用 `~` 表示闭区间，例如 `1000~4000`。
- **开放区间**: 使用 `>=` 或 `<=`，例如 `>=8000`。
- **自摸点数**: 支持 `(子, 亲)` 格式，例如 `(1000, 2000)`，并兼容 `/` 和 `-` 作为分隔符，如 `1000/2000` 或 `1000-2000`。

### 魔鬼模式题库

魔鬼难度的题目由于生成耗时较长，依赖于一个名为 `devil_mode_qbank.json` 的题库文件。首次运行或选择菜单中的“生成题库”选项时，程序会使用多核并行生成一批难题并存入该文件，以备后续练习和考试使用。

## 依赖

- Python 3.x

该项目的核心计算功能不依赖任何第三方库，是一个纯 Python 实现。
